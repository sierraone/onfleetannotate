<html>
<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-jcrop/0.9.15/css/jquery.Jcrop.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-jcrop/0.9.15/js/jquery.Jcrop.js"></script>
  <script>
    var srcCode ="https://script.google.com/macros/s/AKfycbzbw9DNdmKu_fHbJALD59FzQoaUiY_2CSuWphY8OrMUFpCWTqs/exec";
    function writeCode(a) {
      var i;
      i=document.createElement("img");
      i.src = a.urls;
      i.height="500";
      i.id="target";
      document.getElementById("gallery").appendChild(i);
      document.getElementById("number").innerHTML = a.number;
      document.getElementById("row").value = a.row;
    }

  $('#target').Jcrop({
    onChange:   showCoords,
    onSelect:   showCoords
  });


// Simple event handler, called from onChange and onSelect
// event handlers to show an alert, as per the Jcrop 
// invocation above

function showCoords(c)
{
  console.log('x='+ c.x +' y='+ c.y +' x2='+ c.x2 +' y2='+ c.y2)
  console.log('w='+c.w +' h='+ c.h)
};

    $(document).ready(function () {
    var s = document.createElement("script");
    s.type = "text/javascript";
    s.src = srcCode+"?action=query_region&callback=writeCode";
    $("head").append(s);
    });
    
    function refresh(flag) {
      if (flag=="TRUE") location.reload();
    }
    function submit() {
      var row = document.getElementById("row").value;
      var success = document.querySelector('input[name="success"]:checked').value;
      var quality = document.querySelector('input[name="quality"]:checked').value
      var s = document.createElement("script");
       s.type = "text/javascript";
       s.src = srcCode+"?action=write&callback=refresh&row="+row+"&success="+success+"&quality="+quality;
    $("head").append(s);
    }
  </script>
</head>
<body>
<h1>Onfleet Image Labeller</h1>
<div id="gallery">

</div>
<h1 id="number" style="background-color:yellow;"></h1>
<input type="hidden" id="row">
<input type="text" id="x"><input type="text" id="y"><input type="text" id="w"><input type="text" id="h">
  <button type="button" id="submit" onclick="submit()">Submit</button>
</body>
</html>
